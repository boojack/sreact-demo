const e=function(e,t){return{type:e,props:t}};var t;!function(e){function t(e){return e.toLowerCase().replace(/( |^)[A-Z]/g,(e=>e.toLowerCase()))}e.isFunction=function(e){return"function"==typeof e},e.parseEventName=function(e){return t(e.replaceAll("on",""))},e.toFirstUpperCase=function(e){return e.toLowerCase().replace(/( |^)[a-z]/g,(e=>e.toUpperCase()))},e.toFirstLowerCase=t}(t||(t={}));class n{}class o extends n{constructor(e){super(),this.currentElement=e,this.renderedComponents=[],this.node=null}mount(){var e;const{type:n,props:o}=this.currentElement;if("textNode"===n){const t=document.createTextNode(null!==(e=o.nodeValue)&&void 0!==e?e:"");return this.node=t,t}const r=document.createElement(n),s=o;for(const u of Object.keys(s))if("children"!==u)if("function"==typeof s[u]){const e=t.parseEventName(u);r.addEventListener(e,s[u])}else"string"==typeof s[u]&&r.setAttribute(u,s[u]);const i=(o.children||[]).map((e=>c(e)));return this.renderedComponents=i,i.forEach((e=>{const t=e.mount();r.appendChild(t)})),this.node=r,r}unmount(){for(const e of this.renderedComponents)e.unmount()}receive(e){var n,o,r;const s=this.node,i=this.currentElement;this.currentElement=e;const u=i.type,d=e.type,p=i.props,l=e.props;if(u!==d){const t=c(e).mount();return this.node=t,void s.parentNode.replaceChild(t,s)}if("textNode"===u&&"textNode"===d)return void(p.nodeValue!==l.nodeValue&&(s.textContent=null!==(n=l.nodeValue)&&void 0!==n?n:""));const a=function(e,t){const n=e,o=t,r=Object.keys(e).concat(Object.keys(t)),s={};for(const i of r)"children"!==i&&(o.hasOwnProperty(i)?("function"==typeof o[i]||"string"==typeof o[i]&&n[i]!==o[i])&&(s[i]=o[i]):s[i]=null);return s}(p,l);Object.keys(a).forEach((e=>{const n=a[e];if(null===n)s.removeAttribute(e);else if(t.isFunction(n)){const n=t.parseEventName(e);t.isFunction(p[e])&&s.removeEventListener(n,p[e]),s.addEventListener(n,l[e])}else s.setAttribute(e,n)}));const h=null!==(o=p.children)&&void 0!==o?o:[],m=null!==(r=l.children)&&void 0!==r?r:[],f=this.renderedComponents,v=[],C=[];for(let t=0;t<m.length;++t){const e=f[t];if(e)if(typeof h[t]==typeof m[t]){if("object"==typeof h[t]&&"object"==typeof m[t]){if(h[t].type!==m[t].type){const n=e.getHostNode();e.unmount();const o=c(m[t]),r=o.mount();C.push({type:"REPLACE",prevNode:n,nextNode:r}),v.push(o);continue}}else"string"==typeof h[t]&&m[t];e.receive(m[t]),v.push(e)}else{const n=e.getHostNode();e.unmount();const o=c(m[t]),r=o.mount();C.push({type:"REPLACE",prevNode:n,nextNode:r}),v.push(o)}else{const e=c(m[t]),n=e.mount();C.push({type:"ADD",node:n}),v.push(e)}}for(let t=m.length;t<h.length;t++){const e=f[t],n=e.getHostNode();e.unmount(),C.push({type:"REMOVE",node:n})}this.renderedComponents=v;for(const t of C)switch(t.type){case"ADD":s.appendChild(t.node);break;case"REPLACE":s.replaceChild(t.nextNode,t.prevNode);break;case"REMOVE":s.removeChild(t.node)}}getVElement(){return this.currentElement}getRenderedComponents(){return this.renderedComponents}getHostNode(){return this.node}}class r extends n{constructor(e){super(),this.currentElement=e,this.renderedComponent=null}mount(){const{type:e,props:t}=this.currentElement,n=c(e(t));return this.renderedComponent=n,n.mount()}unmount(){const e=this.renderedComponent;e&&e.unmount()}receive(e){var t;const n=this.renderedComponent,o=n.getVElement();this.currentElement=e;const{type:r,props:s}=e,i=r(s);if(o.type===i.type)return void n.receive(i);const u=n.getHostNode();n.unmount();const d=c(i),p=d.mount();this.renderedComponent=d,null===(t=null==u?void 0:u.parentNode)||void 0===t||t.replaceChild(p,u)}getVElement(){return this.currentElement}getRenderedComponent(){return this.renderedComponent}getHostNode(){var e;return null===(e=this.renderedComponent)||void 0===e?void 0:e.getHostNode()}}let s=null,i=null;function u(e,t){if(s=e,i=t,t.firstChild){const n=t.firstChild._internalInstance;if(Boolean(n)){if(n.getVElement().type===e.type)return void n.receive(e);!function(e){const t=e.firstChild._internalInstance;t&&t.unmount();e.innerHTML=""}(t)}}const n=c(e),o=n.mount();o._internalInstance=n,t.appendChild(o)}function c(e){return"string"==typeof e.type?new o(e):new r(e)}const d=[];let p=0;function l(e){var t;const n=p;let o=null!==(t=d[n])&&void 0!==t?t:e;void 0===d[n]&&(d[n]=e);return p++,[o,e=>{d[n]=e,p=0,s&&i&&u(s,i)}]}export{e as h,u as r,l as u};
